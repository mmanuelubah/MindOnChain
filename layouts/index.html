{{ define "main" }}
<main class="home">

<!-- Pixel Font -->
<link rel="preconnect" href="https://fonts.googleapis.com">
<link href="https://fonts.googleapis.com/css2?family=Press+Start+2P&display=swap" rel="stylesheet">

<!-- ================= TOP SECTION ================= -->
<div class="top-section">

  <div class="avatar-container" id="avatarBox">
    <img src="{{ .Site.Params.avatar | absURL }}"
         alt="{{ .Site.Title }}"
         class="author-avatar">
  </div>

  <h1 id="animated-title" class="site-title">
    {{ .Site.Title }}
  </h1>

</div>

<!-- ================= NAV CARDS ================= -->
<div class="cards-container">
  <a href="/posts/" class="card-link">
    <div class="card">
      <div class="card-emoji">üìù</div>
      <div class="card-title">Posts</div>
    </div>
  </a>

  <a href="/books/" class="card-link">
    <div class="card">
      <div class="card-emoji">üìö</div>
      <div class="card-title">Bookshelf</div>
    </div>
  </a>

  <a href="/about/" class="card-link">
    <div class="card">
      <div class="card-emoji">üë§</div>
      <div class="card-title">About</div>
    </div>
  </a>
</div>

<hr class="section-separator">

<!-- ================= CURRENTLY READING ================= -->
<section>
<h2 class="section-title">Currently reading:</h2>

<div class="highlight-box">
<ul class="reading-list">
{{/* Get all pages with status "reading" (case-insensitive) */}}
{{ $reading := slice }}
{{ range .Site.RegularPages }}
  {{ if in (lower .Params.status) "reading" }}
    {{ $reading = $reading | append . }}
  {{ end }}
{{ end }}

{{/* Sort by date descending (newest first) */}}
{{ $reading = sort $reading "Date" "desc" }}

{{/* Show first 5 books */}}
{{ range first 5 $reading }}
<li>
  <a href="{{ if .Params.link }}{{ .Params.link }}{{ else }}{{ .RelPermalink }}{{ end }}" class="reading-link" target="_blank">
    {{ .Title }}
  </a>
</li>
{{ end }}
</ul>
</div>
</section>

<hr class="section-separator">

<!-- ================= FEATURED WRITING ================= -->
<section>
<h2 class="section-title">Featured Writing</h2>

<ul class="writing-list">
{{ $featured := where .Site.RegularPages "Params.featured" true }}
{{ range first 5 $featured }}
<li>
<a href="{{ .RelPermalink }}" class="post-link">{{ .Title }}</a>
<small class="post-meta">{{ .Date.Format "Jan 2, 2006" }}</small>
</li>
{{ end }}
</ul>
</section>

<hr class="section-separator">

<!-- ================= LATEST ROUNDUP ================= -->
<section>
<h2 class="section-title">Latest Roundup</h2>

<div class="highlight-box">
{{ $roundup := where .Site.RegularPages "Params.tags" "intersect" (slice "weekly-roundup") }}
{{ range first 1 (sort $roundup "Date" "desc") }}
<a href="{{ .RelPermalink }}" class="roundup-link">{{ .Title }}</a>
{{ end }}
</div>
</section>

</main>

<!-- ================= AVATAR OVERLAY ================= -->
<div id="avatarOverlay" class="avatar-overlay">
  <img id="overlayImg" src="" alt="">
</div>

<!-- ================= STYLES ================= -->
<style>
.home {
  font-family: system-ui, sans-serif;
  font-size:14.5px;
  max-width:720px;
  margin:auto;
  padding:2rem 1.5rem 3rem;
}

/* Top spacing */
.top-section {
  text-align:center;
  margin-bottom:3rem;
}

/* Pixel headers */
.site-title,
.section-title,
.card-title {
  font-family:'Press Start 2P', monospace;
}

.site-title {
  font-size:.9rem;
  margin-top:14px;
  animation:flicker 4s infinite;
}

.section-title {
  font-size:.7rem;
  margin-bottom:1.2rem;
}

/* Flicker animation */
@keyframes flicker {
  0%,18%,22%,25%,53%,57%,100% {opacity:1;}
  20%,24%,55% {opacity:.4;}
}

/* Avatar container */
.avatar-container {
  width:160px;
  height:100px;
  overflow:hidden;
  border-radius:10px;
  cursor:pointer;
  margin:auto;
  box-shadow:0 4px 12px rgba(0,0,0,.35);
}

.author-avatar {
  width:100%;
  height:100%;
  object-fit:cover;
}

/* Overlay viewer */
.avatar-overlay {
  position:fixed;
  inset:0;
  background:rgba(0,0,0,.85);
  display:flex;
  justify-content:center;
  align-items:center;
  opacity:0;
  pointer-events:none;
  transition:.3s;
  z-index:9999;
}

.avatar-overlay.active {
  opacity:1;
  pointer-events:auto;
}

.avatar-overlay img {
  max-width:90%;
  max-height:85%;
  border-radius:12px;
  animation:zoomIn .3s ease;
}

@keyframes zoomIn {
  from { transform:scale(.9); opacity:0; }
  to { transform:scale(1); opacity:1; }
}

/* Cards spacing */
.cards-container {
  display:flex;
  justify-content:center;
  gap:1.2rem;
  flex-wrap:wrap;
  margin-bottom:3rem;
}

.card {
  background:rgba(255,255,255,.06);
  padding:1.5rem;
  border-radius:10px;
  width:170px;
  text-align:center;
  transition:.2s;
}

.card:hover {
  transform:translateY(-4px);
  box-shadow:0 0 12px rgba(0,255,204,.25);
}

/* Lists */
.writing-list,
.reading-list {
  list-style:none;
  padding:0;
  margin:0;
}

.writing-list li,
.reading-list li {
  border-bottom:1px solid rgba(255,255,255,.08);
  padding:.9rem 0;
}

.post-link,
.reading-link,
.roundup-link {
  color:#ccc;
  text-decoration:none;
}

.post-meta {
  display:block;
  font-size:.8rem;
  opacity:.7;
}

/* Highlight boxes */
.highlight-box {
  background:rgba(255,255,255,.06);
  padding:1.2rem;
  border-radius:10px;
}

/* Section spacing */
section {
  margin-bottom:3rem;
}

.section-separator {
  border:none;
  border-top:1px solid #555;
  margin:2.5rem 0;
}

/* Mobile */
@media(max-width:600px){
  .card { width:150px; }
}
</style>

<!-- ================= SCRIPT ================= -->
<script>
const avatar = document.getElementById("avatarBox");
const overlay = document.getElementById("avatarOverlay");
const overlayImg = document.getElementById("overlayImg");

avatar.onclick = () => {
  overlay.classList.add("active");
  overlayImg.src = avatar.querySelector("img").src;
};

overlay.onclick = () => overlay.classList.remove("active");

document.addEventListener("keydown", e => {
  if (e.key === "Escape")
    overlay.classList.remove("active");
});
</script>

{{ end }}
